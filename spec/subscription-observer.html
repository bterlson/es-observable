<emu-clause id="subscription-observer-abstract-operations">
  <h1>Subscription Observer Abstract Operations</h1>

  <emu-clause id="create-subscription-observer" aoid="CreateSubscriptionObserver">
    <h1>CreateSubscriptionObserver ( _subscription_ )</h1>

    <p>The abstract operation CreateSubscriptionObserver with argument _observer_ is used to create a normalized observer which can be supplied to an observable's subscriber function.  It performs the following steps:</p>

    <emu-alg>
      1. Assert: Type(_subscription_) is Object.
      1. Let _subscriptionObserver_ be ObjectCreate(%SubscriptionObserverPrototype%, «‍ [[Subscription]] »).
      1. Set _subscriptionObserver_.[[Subscription]] to _subscription_.
      1. Return _subscriptionObserver_.
    </emu-alg>
  </emu-clause>

  <emu-clause id="emit-subscription-error" aoid="EmitSubscriptionError">
    <h1>EmitSubscriptionHook ( _O_, _methodName_ [ , _value_ ] )</h1>

    <p>The abstract operation EmitSubscriptionHook with arguments _O_, _methodName_, and optional _value_ is used to invoke method on a given subscriber's observer.  It performs the following steps:</p>

    <emu-alg>
      1. Assert: Type(_O_) is Object.
      1. Assert: _O_ is a Subscription Observer instance.
      1. Assert: Type(_methodName_) is either `"next"`, `"error"`, or `"complete"`.
      1. Assert: _args_ is a List.
      1. Let _subscription_ be _O_.[[Subscription]].
      1. If SubscriptionClosed(_subscription_) is *true*, return *undefined*.
      1. Let _observer_ be _subscription_.[[Observer]].
      1. If _methodName_ is not `"next"`, then
        1. Set _subscription_.[[Observer]] to *undefined*.
      1. Assert: Type(_observer_) is Object.
      1. Let _method_ be GetMethod(_observer_, _methodName_).
      1. WarnIfAbrupt(_method_, *undefined*).
      1. If _method_ is not *undefined*, then
        1. If _value_ is present, let _args_ be « value »; otherwise, let _args_ be the empty list.
        1. Let _result_ be Call(_method_, _observer_, _args).
        1. WarnIfAbrupt(_result_, *undefined*).
      1. If _methodName_ is not `"next"`, then
        1. Perform ! CleanupSubscription(_subscription_).
      1. Return *undefined*.
    </emu-alg>
  </emu-clause>
</emu-clause>

<emu-clause id="subscription-observer-prototype-object">
  <h1>The %SubscriptionObserverPrototype% Object</h1>

  <p>All Subscription Observer objects inherit properties from the %SubscriptionObserverPrototype% intrinsic object.  The %SubscriptionObserverPrototype% object is an ordinary object and its [[Prototype]] internal slot is the %ObjectPrototype% intrinsic object. In addition, %SubscriptionObserverPrototype% has the following properties:</p>

  <emu-clause id="subscription-observer-prototype-closed">
    <h1>get %SubscriptionObserverPrototype%.closed</h1>
    <emu-alg>
      1. Let _O_ be the *this* value.
      1. If Type(_O_) is not Object, throw a *TypeError* exception.
      1. If _O_ does not have all of the internal slots of a Subscription Observer instance, throw a *TypeError* exception.
      1. Let _subscription_ be _O_.[[Subscription]].
      1. Return ! SubscriptionClosed(_subscription_).
    </emu-alg>
  </emu-clause>

  <emu-clause id="subscription-observer-prototype-next">
    <h1>%SubscriptionObserverPrototype%.next ( _value_ )</h1>
    <emu-alg>
      1. Let _O_ be the *this* value.
      1. If Type(_O_) is not Object, throw a *TypeError* exception.
      1. If _O_ does not have all of the internal slots of a Subscription Observer instance, throw a *TypeError* exception.
      1. Perform ! EmitSubscriptionHook(_O_, `"next"`, _value_).
      1. Return *undefined*.
    </emu-alg>
  </emu-clause>

  <emu-clause id="subscription-observer-prototype-error">
    <h1>%SubscriptionObserverPrototype%.error ( _exception_ )</h1>
    <emu-alg>
      1. Let _O_ be the *this* value.
      1. If Type(_O_) is not Object, throw a *TypeError* exception.
      1. If _O_ does not have all of the internal slots of a Subscription Observer instance, throw a *TypeError* exception.
      1. Perform ! EmitSubscriptionHook(_O_, `"error"`, _value_).
      1. Return *undefined*.
    </emu-alg>
  </emu-clause>

  <emu-clause id="subscription-observer-prototype-complete">
    <h1>%SubscriptionObserverPrototype%.complete ( )</h1>
    <emu-alg>
      1. Let _O_ be the *this* value.
      1. If Type(_O_) is not Object, throw a *TypeError* exception.
      1. If _O_ does not have all of the internal slots of a Subscription Observer instance, throw a *TypeError* exception.
      1. Perform ! EmitSubscriptionHook(_O_, `"complete"`).
      1. Return *undefined*.
    </emu-alg>
  </emu-clause>

</emu-clause>
